# åˆ†ç¦»å­˜å‚¨åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“– æ¦‚è¿°

PubMiner ç°åœ¨æ”¯æŒåˆ†ç¦»å­˜å‚¨åŠŸèƒ½æ¥è§£å†³CSVå•å…ƒæ ¼å­—ç¬¦é™åˆ¶é—®é¢˜ï¼ˆ32,767å­—ç¬¦ï¼‰ã€‚å¯¹äºé«˜è¢«å¼•æ–‡çŒ®ï¼Œå¼•ç”¨ä¿¡æ¯å°†è‡ªåŠ¨å­˜å‚¨åœ¨å•ç‹¬çš„JSONæ–‡ä»¶ä¸­ï¼Œè€ŒåŸºæœ¬ä¿¡æ¯ä»ä¿å­˜åœ¨CSVæ–‡ä»¶ä¸­ã€‚

## ğŸ¯ è§£å†³çš„é—®é¢˜

- **CSVå­—ç¬¦é™åˆ¶**: Excel/CSVå•å…ƒæ ¼æœ€å¤šæ”¯æŒ32,767ä¸ªå­—ç¬¦
- **æ•°æ®æˆªæ–­**: è¶…é•¿å¼•ç”¨åˆ—è¡¨ä¼šè¢«æˆªæ–­ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±
- **é«˜è¢«å¼•æ–‡çŒ®**: å¦‚PMID 31978945æœ‰14,000+å¼•ç”¨ï¼Œå­—ç¬¦ä¸²é•¿åº¦è¿œè¶…CSVé™åˆ¶

## ğŸ”§ å·¥ä½œåŸç†

### è‡ªåŠ¨æ£€æµ‹æœºåˆ¶
ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¼•ç”¨ä¿¡æ¯çš„å­—ç¬¦é•¿åº¦ï¼š
- **é˜ˆå€¼**: é»˜è®¤30,000å­—ç¬¦ï¼ˆå¯é…ç½®ï¼‰
- **è§¦å‘æ¡ä»¶**: å½“`Cited_By`æˆ–`References_PMID`å­—æ®µçš„å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡é˜ˆå€¼æ—¶
- **è‡ªåŠ¨åˆ‡æ¢**: æ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³å­˜å‚¨æ–¹å¼

### å­˜å‚¨ç­–ç•¥
```
å¦‚æœ len(str(cited_by_list)) > 30000:
    ä½¿ç”¨åˆ†ç¦»å­˜å‚¨:
        - CSV: åŸºæœ¬ä¿¡æ¯ + å¼•ç”¨ç»Ÿè®¡
        - JSON: å®Œæ•´å¼•ç”¨åˆ—è¡¨
å¦åˆ™:
    ä½¿ç”¨å†…è”å­˜å‚¨:
        - CSV: åŒ…å«å®Œæ•´å¼•ç”¨ä¿¡æ¯
```

## ğŸ“Š æ–‡ä»¶ç»“æ„

### CSVæ–‡ä»¶ç»“æ„ï¼ˆåˆ†ç¦»å­˜å‚¨ï¼‰
```csv
PMID,Title,Authors,Cited_Count,References_Count,Citation_File,Storage_Type,Last_Updated
31978945,"Global age-sex-specific fertility...",5000,150,"citations_31978945.json","separated","2024-10-16T10:30:00"
```

### JSONæ–‡ä»¶ç»“æ„
```json
{
  "PMID": "31978945",
  "Cited_By": ["32000001", "32000002", ...],
  "Cited_Count": 5000,
  "References_PMID": ["20000001", "20000002", ...],
  "References_Count": 150,
  "Last_Updated": "2024-10-16T10:30:00.123456",
  "Data_Source": "PubMed API",
  "Fetcher_Version": "PubMiner v1.0"
}
```

## âš™ï¸ é…ç½®é€‰é¡¹

åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼š

```json
{
  "enable_separated_storage": true,
  "separation_threshold": 30000,
  "max_cell_length": 32767,
  "enable_backup": true
}
```

### é…ç½®è¯´æ˜
- `enable_separated_storage`: æ˜¯å¦å¯ç”¨åˆ†ç¦»å­˜å‚¨ï¼ˆé»˜è®¤: trueï¼‰
- `separation_threshold`: è§¦å‘åˆ†ç¦»å­˜å‚¨çš„å­—ç¬¦æ•°é˜ˆå€¼ï¼ˆé»˜è®¤: 30000ï¼‰  
- `max_cell_length`: CSVå•å…ƒæ ¼æœ€å¤§å­—ç¬¦æ•°ï¼ˆé»˜è®¤: 32767ï¼‰
- `enable_backup`: æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ï¼ˆé»˜è®¤: trueï¼‰

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬ä½¿ç”¨
```python
from core.data_processor import DataProcessor

# åˆ›å»ºå¤„ç†å™¨ï¼ˆè‡ªåŠ¨å¯ç”¨åˆ†ç¦»å­˜å‚¨ï¼‰
config = {
    'enable_separated_storage': True,
    'separation_threshold': 30000
}
processor = DataProcessor(config)

# æ­£å¸¸ç”ŸæˆCSVï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†åˆ†ç¦»å­˜å‚¨
processor.generate_csv(papers, template, output_path)
```

### 2. è¯»å–åˆ†ç¦»å­˜å‚¨çš„æ•°æ®
```python
# åŠ è½½ç‰¹å®šPMIDçš„å®Œæ•´å¼•ç”¨ä¿¡æ¯
citation_data = processor.load_citation_data(csv_file_path, "31978945")

if citation_data:
    print(f"è¢«å¼•ç”¨æ•°: {len(citation_data['Cited_By'])}")
    print(f"å‚è€ƒæ–‡çŒ®æ•°: {len(citation_data['References_PMID'])}")
    print(f"å­˜å‚¨æ–¹å¼: {citation_data.get('Storage_Type', 'unknown')}")
```

### 3. è·å–å­˜å‚¨ç»Ÿè®¡
```python
# è·å–å­˜å‚¨æ–¹å¼ç»Ÿè®¡ä¿¡æ¯
stats = processor.get_storage_statistics(csv_file_path)
print(f"æ€»æ–‡çŒ®æ•°: {stats['total_papers']}")
print(f"åˆ†ç¦»å­˜å‚¨: {stats['separated_storage']} ç¯‡")
print(f"å†…è”å­˜å‚¨: {stats['inline_storage']} ç¯‡")
print(f"åˆ†ç¦»å­˜å‚¨ç‡: {stats['separation_rate']:.1f}%")
```

## ğŸ“ˆ ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | åŸå§‹æ–¹æ³• | åˆ†ç¦»å­˜å‚¨æ–¹æ¡ˆ |
|------|----------|-------------|
| æ•°æ®å®Œæ•´æ€§ | âŒ ä¼šæˆªæ–­ | âœ… 100%å®Œæ•´ |
| CSVå…¼å®¹æ€§ | âœ… æ ‡å‡†æ ¼å¼ | âœ… æ ‡å‡†æ ¼å¼ |
| Excelæ”¯æŒ | âŒ æˆªæ–­æ˜¾ç¤º | âœ… å®Œç¾æ”¯æŒ |
| æ–‡ä»¶å¤§å° | å¤§ä¸”æˆªæ–­ | CSVå°ï¼ŒJSONé€‚ä¸­ |
| æŸ¥è¯¢æ•ˆç‡ | ä¸­ç­‰ | âœ… åŸºæœ¬ä¿¡æ¯å¿«é€ŸæŸ¥è¯¢ |
| æ‰©å±•æ€§ | âŒ å—é™ | âœ… æ— é™åˆ¶ |

## ğŸ” è¯†åˆ«å­˜å‚¨æ–¹å¼

### é€šè¿‡CSVå­—æ®µåˆ¤æ–­
- `Storage_Type` å­—æ®µå€¼:
  - `separated`: åˆ†ç¦»å­˜å‚¨
  - `inline`: å†…è”å­˜å‚¨  
  - `inline_truncated`: å†…è”å­˜å‚¨ä½†è¢«æˆªæ–­

- `Citation_File` å­—æ®µ:
  - æœ‰å€¼: åˆ†ç¦»å­˜å‚¨ï¼Œå€¼ä¸ºå¯¹åº”çš„JSONæ–‡ä»¶å
  - ç©ºå€¼: å†…è”å­˜å‚¨

### é€šè¿‡æ—¥å¿—è¾“å‡ºåˆ¤æ–­
```
PMID 31978945: ä½¿ç”¨åˆ†ç¦»å­˜å‚¨ (å¼•ç”¨æ•°: 14500)
PMID 12345678: ä½¿ç”¨å†…è”å­˜å‚¨ (å¼•ç”¨æ•°: 10)
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### 1. åˆ†ç¦»å­˜å‚¨å¤±è´¥
**ç°è±¡**: `Storage_Type` æ˜¾ç¤º `inline_truncated`
**åŸå› **: JSONæ–‡ä»¶ä¿å­˜å¤±è´¥
**è§£å†³**: æ£€æŸ¥è¾“å‡ºç›®å½•æƒé™ï¼Œç¡®ä¿æœ‰å†™å…¥æƒé™

### 2. å¼•ç”¨æ–‡ä»¶ç¼ºå¤±
**ç°è±¡**: CSVä¸­æœ‰`Citation_File`ä½†æ–‡ä»¶ä¸å­˜åœ¨
**åŸå› **: æ–‡ä»¶ç§»åŠ¨æˆ–åˆ é™¤
**è§£å†³**: é‡æ–°è¿è¡Œåˆ†ææˆ–ä»å¤‡ä»½æ¢å¤

### 3. æ•°æ®ä¸ä¸€è‡´
**ç°è±¡**: CSVä¸­çš„è®¡æ•°ä¸JSONä¸­çš„å®é™…æ•°é‡ä¸ç¬¦
**åŸå› **: æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­çš„å¼‚å¸¸
**è§£å†³**: ä½¿ç”¨æ•°æ®éªŒè¯åŠŸèƒ½æ£€æŸ¥

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶ç®¡ç†
- ä¿æŒCSVæ–‡ä»¶å’Œå¯¹åº”çš„JSONæ–‡ä»¶åœ¨åŒä¸€ç›®å½•
- å®šæœŸå¤‡ä»½å¼•ç”¨JSONæ–‡ä»¶
- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®æ–‡ä»¶

### 2. æ€§èƒ½ä¼˜åŒ–
- å¯¹äºå¤§æ‰¹é‡å¤„ç†ï¼Œé€‚å½“è°ƒæ•´`separation_threshold`
- ä½¿ç”¨SSDå­˜å‚¨æé«˜JSONæ–‡ä»¶è¯»å†™é€Ÿåº¦
- æ‰¹é‡æ“ä½œæ—¶è€ƒè™‘å†…å­˜ä½¿ç”¨

### 3. æ•°æ®éªŒè¯
```python
# å®šæœŸéªŒè¯æ•°æ®å®Œæ•´æ€§
validation_result = processor.validate_data_quality(papers, template)
print(f"æ•°æ®è´¨é‡å¾—åˆ†: {validation_result['overall_quality_score']}")
```

## ğŸ”„ å‘åå…¼å®¹æ€§

- **ç°æœ‰æ•°æ®**: å®Œå…¨å…¼å®¹ï¼Œæ—§çš„CSVæ–‡ä»¶æ­£å¸¸å·¥ä½œ
- **é…ç½®è¿ç§»**: æ–°å¢é…ç½®é¡¹æœ‰é»˜è®¤å€¼ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰é…ç½®
- **APIä¸å˜**: æ‰€æœ‰ç°æœ‰çš„APIè°ƒç”¨æ–¹å¼ä¿æŒä¸å˜

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½: `python tests/test_main_program_integration.py`
3. æ£€æŸ¥é…ç½®æ–‡ä»¶è®¾ç½®
4. éªŒè¯è¾“å‡ºç›®å½•æƒé™

---

*æœ€åæ›´æ–°: 2024-10-16*